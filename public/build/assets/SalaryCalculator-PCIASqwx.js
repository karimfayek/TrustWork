import{r as o,a as q,j as e}from"./app-DlGAX9PN.js";function I({user:s,forUser:n=!1,totalAdvance:l,totalExpense:i,remaining:G}){var p,u,g,N,y;const[r,f]=o.useState({}),[v,w]=o.useState(null),x=q().props.auth.user,m=(x==null?void 0:x.rolesnames)??[];Number(r==null?void 0:r.absenceDays)*Number(Number((p=s.salary)==null?void 0:p.final_salary)/30);const F=(r==null?void 0:r.month_days)-(r==null?void 0:r.absenceDays),S=(r==null?void 0:r.absenceDays)<7?F:r.att_days,_=Number(((u=s.salary)==null?void 0:u.final_salary)??0)/(r==null?void 0:r.month_days)*Number(S??0),b=Number(((g=s.salary)==null?void 0:g.final_salary)??0)-_,T=Number(Number(((N=s.salary)==null?void 0:N.final_salary)??0)+Number((r==null?void 0:r.rewards)??0)-b+Number((r==null?void 0:r.transportaionFees)??0)-Number((r==null?void 0:r.lostCostThisMonth)??0)-Number((r==null?void 0:r.deductions)??0)-Number((r==null?void 0:r.basics)??0)-Number((r==null?void 0:r.loans)??0)-Number((r==null?void 0:r.remaining)??0)).toFixed(2),C=Number(((y=s.salary)==null?void 0:y.final_salary)??0)*r.att_days,E=s.temporary?C:T,[c,M]=o.useState(()=>{const d=new Date,h=new Date(d.getFullYear(),d.getMonth(),1),j=n?new Date(d):new Date(d.getFullYear(),d.getMonth()+1,0);return{from:h.toLocaleDateString("en-CA"),to:j.toLocaleDateString("en-CA")}}),[A,k]=o.useState(c);return o.useEffect(()=>{const d=setTimeout(()=>{k(c)},1900);return()=>{clearTimeout(d)}},[c]),o.useEffect(()=>{const d=async()=>{try{const j=await(await fetch(`/calc-emp-att/${s.id}?from=${c.from}&to=${c.to}`)).json();f(j)}catch(h){console.error("Error fetching attendance data:",h)}};c.from&&c.to&&d()},[A,s.id]),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"bg-gray-100 mb-12 p-5 shadow-sm ",children:[e.jsx("h2",{className:"bg-white p-5 text-2xl text-center underline",children:s.name}),!n&&e.jsx($,{month:v,setMonth:w,filters:c,setFilters:M}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[!n&&["admin","acc"].some(d=>m==null?void 0:m.includes(d))&&x.email!=="sherok@trustits.net"&&e.jsxs(e.Fragment,{children:[e.jsx(L,{user:s,attData:r}),e.jsx(P,{attData:r,absenceScore:b}),e.jsx(Y,{deserved:E})]}),e.jsx(O,{attData:r}),e.jsx(z,{attData:r}),e.jsx(B,{attData:r})]})]})})}const $=({filters:s,setFilters:n})=>e.jsx("div",{children:e.jsxs("form",{className:"bg-white shadow rounded p-4 mb-8 space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-600",children:" عرض نتائج"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"from",className:"mb-2",children:"من تاريخ"}),e.jsx("input",{required:!0,className:"border rounded p-2",type:"date",value:s.from,onChange:l=>n({...s,from:l.target.value})})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"from",className:"mb-2",children:"الى تاريخ"}),e.jsx("input",{required:!0,className:"border rounded p-2",type:"date",value:s.to,onChange:l=>n({...s,to:l.target.value})})]})]})]})}),L=({user:s,attData:n})=>{var l;return e.jsxs("div",{className:"bg-white p-4 shadow sm:rounded-lg sm:p-8",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900",children:"استحقاقات"}),e.jsx("hr",{}),e.jsxs("div",{children:[e.jsx("b",{children:"المرتب"}),e.jsx("p",{className:"text-green-800",children:Number((l=s.salary)==null?void 0:l.final_salary)})]}),e.jsxs("div",{children:[e.jsx("b",{children:"الانتقالات"}),e.jsx("p",{className:"text-green-800",children:Number(n==null?void 0:n.transportaionFees).toFixed(2)})]}),e.jsxs("div",{children:[e.jsx("b",{children:"المكافئات"}),e.jsx("p",{className:"text-green-800",children:Number(n==null?void 0:n.rewards).toFixed(2)})]})]})},P=({attData:s,absenceScore:n})=>e.jsxs("div",{className:"bg-white p-4 shadow sm:rounded-lg sm:p-8",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900",children:"استقطاعات"}),e.jsx("hr",{}),e.jsxs("div",{children:[e.jsx("b",{children:"استقطاعات من الراتب"}),e.jsx("p",{className:"text-red-800",children:Number(s==null?void 0:s.deductions).toFixed(2)})]}),e.jsxs("div",{children:[e.jsx("b",{children:" جزاءات"}),e.jsx("p",{className:"text-red-800",children:Number(s==null?void 0:s.basics).toFixed(2)})]}),e.jsxs("div",{children:[e.jsx("b",{children:"غياب"}),e.jsx("p",{className:"text-red-800",children:e.jsx("span",{children:n})})]}),e.jsxs("div",{children:[e.jsx("b",{children:"مفقودات"}),e.jsx("p",{className:"text-red-800",children:e.jsx("span",{children:s.lostCostThisMonth})})]}),e.jsxs("div",{children:[e.jsx("b",{children:"عهد - مصروفات"}),e.jsx("p",{className:"text-red-800",children:s==null?void 0:s.remaining})]}),e.jsxs("div",{children:[e.jsx("b",{children:" سلف"}),e.jsx("p",{className:"text-red-800",children:s==null?void 0:s.loans})]})]}),Y=({deserved:s})=>e.jsxs("div",{className:"bg-white shadow sm:rounded-lg sm:p-8 border mt-4 p-2.5 text-center",children:[e.jsx("b",{className:"border p-1.5",children:"المرتب المستحق"}),e.jsxs("p",{dir:"ltr",className:`font-bold mt-3 text-2xl ${s<1?"text-red-500":"text-green-500"}`,children:[e.jsx("br",{}),s]})]}),O=({attData:s})=>e.jsxs("div",{className:"bg-white p-4 shadow sm:rounded-lg sm:p-8",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900",children:"الحضور"}),e.jsx("hr",{}),e.jsx("b",{children:"النسبة المئوية للحضور"}),e.jsxs("p",{children:[s==null?void 0:s.attendance_percentage," %"]}),e.jsxs("div",{children:[e.jsx("b",{children:"عدد ايام الحضور المتأخر"}),e.jsx("p",{children:s==null?void 0:s.late_days})]}),e.jsxs("div",{children:[e.jsx("b",{children:"عدد ايام الحضور خلال الشهر"}),e.jsx("p",{children:s==null?void 0:s.att_days})]}),e.jsxs("div",{children:[e.jsx("b",{children:"عدد ايام الغياب خلال الشهر"}),e.jsx("p",{children:s==null?void 0:s.absenceDays})]})]}),z=({attData:s})=>e.jsxs("div",{className:"bg-white p-4 shadow sm:rounded-lg sm:p-8",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900",children:"المهام"}),e.jsx("hr",{}),e.jsx("b",{children:"اجمالى المهام المسندة خلال الشهر"}),e.jsx("p",{children:s==null?void 0:s.alltasks}),e.jsxs("div",{children:[e.jsx("b",{children:"المهام المكتمله"}),e.jsx("p",{children:s==null?void 0:s.tasksCompleted})]}),e.jsxs("div",{children:[e.jsx("b",{children:"النسبه المئوية لاكمال المهام"}),e.jsxs("p",{children:[s==null?void 0:s.completedTasksPercentage," %"]})]})]}),B=({attData:s})=>{var n;return e.jsxs("div",{className:"bg-white p-4 shadow sm:rounded-lg sm:p-8",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900",children:"الادوات"}),e.jsx("hr",{}),e.jsx("b",{children:"ادوات معه:"}),e.jsx("ul",{className:"inline-flex flex-wrap",children:s.assignments&&s.assignments.map(l=>{var i;return l.status==="assigned"&&e.jsxs("li",{className:"bg-[#b7ffb7] p-1.5 m-2",children:[(i=l.tool)==null?void 0:i.name," * ",l.quantity]},l.id)})}),e.jsxs("div",{children:[e.jsx("b",{children:"ادوات مفقودة:"}),((n=s.lostThismonth)==null?void 0:n.length)<1&&e.jsx("p",{className:"bg-[#FF2D20]/10 p-1.5 m-2",children:"لا يوجد"}),e.jsx("ul",{className:"inline-flex flex-wrap",children:s.lostThismonth&&s.lostThismonth.map(l=>{var i;return e.jsxs("li",{className:"bg-[#FF2D20]/10 p-1.5 m-2",children:[(i=l.tool)==null?void 0:i.name," * ",l.quantity," *"," ",l.tool.estimated_value," ج"]},l.id)})})]}),e.jsxs("div",{children:[e.jsx("b",{children:"قيمه الادوات المفقودة"}),e.jsxs("p",{children:[s.lostCostThisMonth," ج"]})]})]})};export{I as default};
