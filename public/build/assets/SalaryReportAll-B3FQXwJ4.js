import{r as d,j as s,L as _}from"./app-DlGAX9PN.js";import E from"./ReportLayout-5-HwSqPl.js";import"./AuthenticatedLayout-C7-uZEiO.js";import"./ApplicationLogo-DhpMNBYC.js";import"./ResponsiveNavLink-BuEhCzeB.js";import"./transition-JWbJrjM_.js";function C({user:r,filters:i,setLoading:o,onCalculated:c}){var N,u,j,f,y,g;const[e,a]=d.useState({}),[l,x]=d.useState(i);d.useEffect(()=>{const b=setTimeout(()=>{x(i)},1e3);return()=>{clearTimeout(b)}},[i]),d.useEffect(()=>{const b=async()=>{try{o(!0);const S=await(await fetch(`/calc-emp-att/${r.id}?from=${l.from}&to=${l.to}`)).json();a(S)}catch(v){console.error("خطأ في جلب بيانات الحضور:",v)}finally{o(!1)}};l.from&&l.to&&b()},[r.id,l]),Number(((N=r.salary)==null?void 0:N.final_salary)??0)/30*Number((e==null?void 0:e.absenceDays)??0);const n=(e==null?void 0:e.month_days)-(e==null?void 0:e.absenceDays),t=(e==null?void 0:e.absenceDays)<7?n:e.att_days,m=Number(((u=r.salary)==null?void 0:u.final_salary)??0)/(e==null?void 0:e.month_days)*Number(t??0),p=Number(((j=r.salary)==null?void 0:j.final_salary)??0)-m,w=Number(Number(((f=r.salary)==null?void 0:f.final_salary)??0)+Number((e==null?void 0:e.rewards)??0)-p+Number((e==null?void 0:e.transportaionFees)??0)-Number((e==null?void 0:e.lostCostThisMonth)??0)-Number((e==null?void 0:e.deductions)??0)-Number((e==null?void 0:e.basics)??0)-Number((e==null?void 0:e.loans)??0)-Number((e==null?void 0:e.remaining)??0)).toFixed(2),F=Number(((y=r.salary)==null?void 0:y.final_salary)??0)*e.att_days,h=r.temporary?F:w;return d.useEffect(()=>{!isNaN(h)&&c&&c(h)},[h]),s.jsxs("tr",{className:"border-b",children:[s.jsxs("td",{className:"p-2",children:[s.jsx(_,{className:"hover:text-blue-500",href:route("admin.user.edit",r.id),children:r.name})," "]}),s.jsx("td",{className:"p-2",children:((g=r.salary)==null?void 0:g.final_salary)??0}),s.jsx("td",{className:"p-2",children:(e==null?void 0:e.att_days)??0}),s.jsx("td",{className:"p-2",children:(e==null?void 0:e.absenceDays)??0}),s.jsx("td",{className:"p-2",children:Number(p).toFixed(2)}),s.jsx("td",{className:"p-2",children:Number(e==null?void 0:e.lostCostThisMonth).toFixed(2)}),s.jsx("td",{className:"p-2",children:e==null?void 0:e.remaining}),s.jsx("td",{className:"p-2",children:(e==null?void 0:e.basics)??0}),s.jsx("td",{className:"p-2",children:(e==null?void 0:e.deductions)??0}),s.jsx("td",{className:"p-2",children:(e==null?void 0:e.loans)??0}),s.jsx("td",{className:"p-2",children:(e==null?void 0:e.transportaionFees)??0}),s.jsx("td",{className:"p-2",children:(e==null?void 0:e.rewards)??0}),s.jsx("td",{className:"p-2 font-bold",children:h})]})}const T=({filters:r,setFilters:i,loading:o})=>{const[c,e]=d.useState(r),a=l=>{l.preventDefault(),i(c)};return s.jsxs("form",{onSubmit:a,className:"bg-white shadow rounded p-4 mb-8 space-y-4 print:hidden",children:[s.jsx("h2",{className:"text-lg font-semibold text-gray-600",children:"عرض نتائج"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[s.jsxs("div",{className:"flex flex-col",children:[s.jsx("label",{htmlFor:"from",className:"mb-2",children:"من تاريخ"}),s.jsx("input",{required:!0,className:"border rounded p-2",type:"date",value:c.from,onChange:l=>e({...c,from:l.target.value})})]}),s.jsxs("div",{className:"flex flex-col",children:[s.jsx("label",{htmlFor:"to",className:"mb-2",children:"إلى تاريخ"}),s.jsx("input",{required:!0,className:"border rounded p-2",type:"date",value:c.to,onChange:l=>e({...c,to:l.target.value})})]}),s.jsx("div",{className:"flex flex-col justify-end",children:s.jsx("button",{type:"submit",disabled:o,className:`py-2 px-4 rounded-lg transition text-white ${o?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700"}`,children:o?"جاري التنفيذ...":"تنفيذ"})}),s.jsx("div",{className:"flex flex-col justify-end",children:s.jsx("button",{type:"button",onClick:()=>window.print(),className:"bg-green-600 text-white py-2 px-4 rounded-lg hover:bg-green-700 transition",children:"طباعة"})})]})]})};function q({users:r}){const[i,o]=d.useState({}),[c,e]=d.useState(!1),[a,l]=d.useState(()=>{const n=new Date,t=new Date(n.getFullYear(),n.getMonth(),1),m=new Date(n.getFullYear(),n.getMonth()+1,0);return{from:t.toLocaleDateString("en-CA"),to:m.toLocaleDateString("en-CA")}});d.useEffect(()=>{o({})},[a]);const x=Object.values(i).reduce((n,t)=>n+Number(t||0),0);return s.jsxs(E,{children:[s.jsx("div",{className:"mb-4",children:s.jsx(T,{filters:a,setFilters:l,loading:c})}),s.jsxs("div",{className:"mb-[100px]",children:[s.jsx("h2",{className:"text-xl font-semibold border-b pb-2 mb-2",children:"الرواتب"}),s.jsxs("table",{className:"min-w-full border border-gray-300 text-sm",children:[s.jsx("thead",{className:"bg-gray-100",children:s.jsxs("tr",{children:[s.jsx("th",{className:"p-2 border",children:"الموظف"}),s.jsx("th",{className:"p-2 border",children:"الراتب"}),s.jsx("th",{className:"p-2 border",children:"الحضور"}),s.jsx("th",{className:"p-2 border",children:"عدد ايام الغياب"}),s.jsx("th",{className:"p-2 border",children:"الغياب"}),s.jsx("th",{className:"p-2 border",children:"مفقودات"}),s.jsx("th",{className:"p-2 border",children:"عهد"}),s.jsx("th",{className:"p-2 border",children:"الاستقطاعات"}),s.jsx("th",{className:"p-2 border",children:"جزاءات"}),s.jsx("th",{className:"p-2 border",children:"سلف"}),s.jsx("th",{className:"p-2 border",children:"الانتقالات"}),s.jsx("th",{className:"p-2 border",children:"المكافآت"}),s.jsx("th",{className:"p-2 border",children:"المستحق"})]})}),s.jsxs("tbody",{children:[r==null?void 0:r.map(n=>s.jsx(C,{user:n,filters:a,setLoading:e,onCalculated:t=>o(m=>({...m,[n.id]:Math.max(Number(t)||0,0)}))},n.id)),s.jsxs("tr",{className:"font-bold bg-gray-50",children:[s.jsx("td",{colSpan:10,className:"p-2 border text-center",children:"الإجمالي"}),s.jsx("td",{className:"p-2 border text-center",children:x.toFixed(2)})]})]})]})]})]})}export{q as default};
