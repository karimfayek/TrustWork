import{r as N,a as H,u as G,j as e,H as O,R as z}from"./app-010wRZBS.js";import{I as c}from"./InputLabel-Dhpcpp8j.js";import{T as o}from"./TextInput-B2I8iYvo.js";import{P as J}from"./PrimaryButton-ClguZZ8Q.js";import{I as i}from"./InputError-CL0nuJxm.js";import{A as K}from"./AuthenticatedLayout-wz4UIe47.js";import"./ApplicationLogo-CLCJLUPQ.js";import"./ResponsiveNavLink-dcmeS5bU.js";import"./transition-BmRszfgL.js";function te({users:h}){const[g,A]=N.useState([]),b=H().props.auth.user,f=b==null?void 0:b.role,{data:r,setData:n,post:E,processing:D,errors:m}=G({name:"",description:"",start_date:"",end_date:"",customer_name:"",customer_email:"",project_code:"",advance_payment:0,user_ids:[],tasks:[]}),[p,_]=N.useState(""),k=new Date().toISOString().split("T")[0];N.useEffect(()=>{r.start_date||(n("start_date",k),n("end_date",k))},[]);const P=s=>{s.preventDefault(),E(route("admin.projects.store"))},R=()=>{console.log(r.user_ids,"datauserids"),n("tasks",[...r.tasks,{title:"",description:"",start_date:"",users:[...g],end_date:"",quantity:"",unit:""}]);const s=parseInt(p);_(s+1)},U=()=>{const s=parseInt(p);if(isNaN(s)||s<=0){n(t=>({...t,tasks:[]}));return}n(t=>{let a=[...t.tasks];if(a.length<s){const d=s-a.length,u=Array.from({length:d},()=>({title:"",description:"",start_date:"",end_date:"",users:[...g],quantity:"",unit:""}));a=[...a,...u]}else a.length>s&&(a=a.slice(0,s));return{...t,tasks:a}})},x=(s,t,a)=>{const d=[...r.tasks];d[s][t]=a,n("tasks",d)},L=s=>{const t=Number(s);let a=[...g];a.includes(t)?a=a.filter(d=>d!==t):a.push(t),A(a),n("user_ids",a)},W=(s,t)=>{const a=Number(t),d=[...r.tasks],u=d[s].users||[];u.includes(a)?d[s].users=u.filter(j=>j!==a):d[s].users=[...u,a],n("tasks",d)},B=(s,t)=>{s.preventDefault();const a=parseInt(p);_(a-1),n(d=>{const u=d.tasks.filter((j,v)=>v!==t);return{...d,tasks:u}})};return e.jsx(e.Fragment,{children:e.jsxs(K,{children:[e.jsx(O,{title:"إضافة مشروع جديد"}),e.jsxs("div",{className:"mx-auto px-6 py-8 bg-white rounded shadow",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800 mb-6 text-center",children:"إضافة مشروع جديد"}),e.jsxs("form",{onSubmit:P,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"name",value:"اسم المشروع"}),e.jsx(o,{id:"name",type:"text",value:r.name,className:"mt-1 block w-full",onChange:s=>n("name",s.target.value),required:!0}),e.jsx(i,{message:m.name,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"customer_name",value:"اسم العميل"}),e.jsx(o,{id:"name",type:"text",value:r.customer_name,className:"mt-1 block w-full",onChange:s=>n("customer_name",s.target.value),required:!0}),e.jsx(i,{message:m.customer_name,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"customer_name",value:"ايميل العميل"}),e.jsx(o,{id:"name",type:"text",value:r.customer_email,className:"mt-1 block w-full",onChange:s=>n("customer_email",s.target.value)}),e.jsx(i,{message:m.customer_email,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"project_code",value:"كود المشروع "}),e.jsx(o,{id:"name",type:"text",value:r.project_code,className:"mt-1 block w-full",onChange:s=>n("project_code",s.target.value),required:!0}),e.jsx(i,{message:m.project_code,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"description",value:"وصف المشروع"}),e.jsx(o,{id:"description",type:"text",value:r.description,className:"mt-1 block w-full",onChange:s=>n("description",s.target.value)}),e.jsx(i,{message:m.description,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"advance_payment",value:"دفعه مقدمه "}),e.jsx(o,{id:"advance_payment",type:"number",value:r.advance_payment,className:"mt-1 block w-full",onWheel:s=>s.target.blur(),onChange:s=>n("advance_payment",s.target.value)}),e.jsx(i,{message:m.advance_payment,className:"mt-2"})]}),f!=="tech"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"start_date",value:"تاريخ البداية"}),e.jsx(o,{required:!0,id:"start_date",type:"date",value:r.start_date,className:"mt-1 block w-full",onChange:s=>n("start_date",s.target.value)}),e.jsx(i,{message:m.start_date,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"end_date",value:"تاريخ النهاية"}),e.jsx(o,{required:!0,id:"end_date",type:"date",value:r.end_date,min:r.start_date,className:"mt-1 block w-full",onChange:s=>n("end_date",s.target.value)}),e.jsx(i,{message:m.end_date,className:"mt-2"})]})]}),e.jsxs("div",{className:"border p-2",children:[e.jsx(c,{className:"mb-2",htmlFor:"user_ids",value:"فريق العمل "}),h==null?void 0:h.map(s=>{var t;return e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",value:s.id,checked:(t=r.user_ids)==null?void 0:t.includes(Number(s.id)),onChange:()=>L(s.id),className:"mr-2 ml-1"}),s.name]},s.id)}),e.jsx(i,{message:m.user_ids,className:"mt-2"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-semibold",children:"عدد البنود:"}),e.jsx("input",{required:!0,type:"number",value:p,onWheel:s=>s.target.blur(),onBlur:s=>U(),onChange:s=>_(s.target.value),className:"border p-2 rounded w-full",min:"1"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2 position-sticky top-0 sticky p-3 bg-white",children:[e.jsx(c,{value:"بنود المشروع"}),e.jsx("button",{type:"button",onClick:R,className:"text-sm text-blue-600 hover:underline",children:"+ إضافة بند"})]}),r.tasks.map((s,t)=>{var a,d,u,j,v,y,C,w,q,F,T,I;return e.jsxs(z.Fragment,{children:[e.jsxs("p",{className:"font-bold",children:["بند رقم ",t+1]}),e.jsxs("div",{className:"p-4 mb-4 bg-gray-50 rounded border space-y-3 grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx(c,{className:"mt-3",value:"عنوان البند"}),e.jsx(o,{required:!0,type:"text",value:s.title,onChange:l=>x(t,"title",l.target.value),className:"mt-1 block w-full"}),e.jsx(i,{message:(d=(a=m.tasks)==null?void 0:a[t])==null?void 0:d.title,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(c,{value:"وصف البند"}),e.jsx(o,{type:"text",value:s.description,onChange:l=>x(t,"description",l.target.value),className:"mt-1 block w-full"}),e.jsx(i,{message:(j=(u=m.tasks)==null?void 0:u[t])==null?void 0:j.description,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(c,{value:"الكمية "}),e.jsx(o,{required:!0,type:"number",onWheel:l=>l.target.blur(),value:s.quantity,onChange:l=>x(t,"quantity",l.target.value),className:"mt-1 block w-full"}),e.jsx(i,{message:(y=(v=m.tasks)==null?void 0:v[t])==null?void 0:y.quantity,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(c,{value:" الوحدة"}),e.jsxs("select",{required:!0,value:s.unit,onChange:l=>x(t,"unit",l.target.value),className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",disabled:!0,children:"choose Unit"}),e.jsx("option",{value:"meter",children:"meter"}),e.jsx("option",{value:"number",children:"number"}),e.jsx("option",{value:"ls",children:"LS"}),e.jsx("option",{value:"collaborative",children:"تعاونى"})]}),e.jsx(i,{message:(w=(C=m.tasks)==null?void 0:C[t])==null?void 0:w.unit,className:"mt-1"})]}),f!=="tech"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(c,{value:"تاريخ البداية"}),e.jsx(o,{required:!0,type:"date",value:s.start_date,min:r.start_date,max:r.end_date,onChange:l=>x(t,"start_date",l.target.value),className:"mt-1 block w-full"}),e.jsx(i,{message:(F=(q=m.tasks)==null?void 0:q[t])==null?void 0:F.start_date,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(c,{value:"تاريخ النهاية"}),e.jsx(o,{required:!0,type:"date",value:s.end_date,min:r.start_date,max:r.end_date,onChange:l=>x(t,"end_date",l.target.value),className:"mt-1 block w-full"}),e.jsx(i,{message:(I=(T=m.tasks)==null?void 0:T[t])==null?void 0:I.end_date,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(c,{value:" اسناد المهام"}),e.jsx("div",{className:"bg-white border gap-2 grid grid-cols-2 mt-1 p-1.5",children:h==null?void 0:h.map(l=>{var S;return e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",value:l.id,checked:(S=s.users)==null?void 0:S.includes(Number(l.id)),onChange:()=>W(t,l.id),className:"mr-2 ml-1"}),l.name]},l.id)})})]})]}),e.jsx("button",{onClick:l=>B(l,t),className:"text-red-500 hover:underline text-sm",children:"🗑 حذف"})]},t)]},t)})]}),e.jsx("div",{children:e.jsx(J,{className:"btn btn-green btn-fixed-bottom",disabled:D,children:"إضافة المشروع"})})]})]})]})})}export{te as default};
