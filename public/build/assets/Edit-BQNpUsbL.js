import{r,a as R,u as C,j as e,H as ae,b as _}from"./app-010wRZBS.js";import ne from"./UserForm-BBAgBxpF.js";import de from"./SalaryCalculator-CMfz6HPu.js";import le from"./AdvancesList-Cc7Xwg8r.js";import"./TextInput-B2I8iYvo.js";import re from"./FinancialSettlement-Ccxs1Ca3.js";import{A as oe}from"./AuthenticatedLayout-wz4UIe47.js";import{D as k}from"./DeleteButton-DZvfS_k5.js";import ie from"./Loans-CzoV1RO7.js";import ce from"./Leaves-BdcDL9x6.js";import"./InputLabel-Dhpcpp8j.js";import"./PrimaryButton-ClguZZ8Q.js";import"./InputError-CL0nuJxm.js";import"./ApplicationLogo-CLCJLUPQ.js";import"./ResponsiveNavLink-dcmeS5bU.js";import"./transition-BmRszfgL.js";import"./HandelDelete-CbZVKxrk.js";function _e({user:a}){r.useEffect(()=>{const s=window.location.hash;if(s){const t=document.querySelector(s);t&&t.scrollIntoView({behavior:"smooth"})}},[]),console.log(a,"user");const N=R().props.auth.user,E=N==null?void 0:N.role,{acceptedAdvances:o,pendingAdvances:q,expenses:U,totalAdvance:F,totalExpense:y,remaining:u,deductions:W,roles:H}=R().props,[L,x]=r.useState(q),z=s=>{console.log(s),_.post(route("admin.advance.delete"),{id:s},{preserveScroll:!0,onSuccess:()=>{x(t=>t.filter(d=>d.id!==s)),h(!1),D(""),S(null)}})},[B,h]=r.useState(!1),[w,S]=r.useState(null),[A,D]=r.useState(""),O=s=>{S(s),h(!0)},V=()=>{const s=L.find(t=>t.id===w);_.post(route("admin.advance.status"),{advance_id:w,status:"accepted",amount:s.amount,note:s.note,payment_method:A},{preserveScroll:!0,onSuccess:()=>{x(t=>t.filter(d=>d.id!==w)),h(!1),D(""),S(null)}})},G=(s,t,d)=>{x(m=>m.map((f,te)=>te===s?{...f,[t]:d}:f))},J=(s,t)=>{const d=L.find(m=>m.id===s);_.post(route("admin.advance.status"),{advance_id:s,status:t,amount:d.amount,note:d.note},{preserveScroll:!0,onSuccess:()=>{x(m=>m.filter(f=>f.id!==s))}})},{data:p,setData:j,post:K,processing:Q,reset:T,errors:v}=C({amount:"",note:"",user_id:a==null?void 0:a.id,project_id:"",method:""}),{data:M,setData:P,post:X,processing:Y,reset:Z,errors:b}=C({amount:"",description:"",user_id:a==null?void 0:a.id}),{data:i,setData:g,post:$,processing:ee,reset:se,errors:l}=C({amount:"",note:"",type:"",deducted_at:"",user_id:a==null?void 0:a.id}),[n,I]=r.useState(""),c=s=>{I(n===s?"":s)};return e.jsxs(oe,{children:[e.jsx(ae,{title:"تعديل موظف "}),e.jsxs("div",{className:" px-6 py-8 bg-white rounded shadow",children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-800 mb-6 ",children:["تعديل موظف"," ",e.jsx("button",{onClick:()=>c("userform"),children:e.jsxs("p",{className:"border p-1 border-black text-sm",children:["  ",n==="userform"?"اخفاء":"عرض"]})})]}),n==="userform"&&e.jsx(ne,{user:a,allRoles:H}),e.jsx("hr",{}),e.jsxs("h1",{className:"text-2xl font-bold text-gray-800 mb-6 ",children:["الحضور - المرتب - المهام - معلومات اخرى",e.jsx("button",{onClick:()=>c("salary"),children:e.jsxs("p",{className:"border p-1 border-black text-sm",children:["  ",n==="salary"?"اخفاء":"عرض"]})})]}),n==="salary"&&e.jsx(de,{user:a,acceptedAdvances:o,totalAdvance:F,totalExpense:y,remaining:u}),e.jsx("hr",{}),e.jsxs("div",{className:"p-6",children:[e.jsxs("h1",{className:"text-2xl font-bold mb-4",children:[" العهد والمصروفات",e.jsx("button",{onClick:()=>c("advances"),children:e.jsxs("p",{className:"border p-1 border-black text-sm",children:["  ",n==="advances"?"اخفاء":"عرض"]})})]}),n==="advances"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"إجمالي العهدة:"})," ",F," ج"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"إجمالي المصروفات:"})," ",y," ج"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"المتبقي:"})," ",u," ج",u>0&&e.jsx(re,{user_id:a.id,amountOrig:u,advances:o})]})]}),e.jsxs("div",{className:"md:grid grid-cols-3 gap-6",id:"advances",children:[e.jsx(le,{advances:q,type:"pending",onDelete:z,onApprove:O,onReject:J,onUpdate:G}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold mb-2",children:"العهد المُستلمة"}),e.jsx("ul",{className:"bg-white p-4 rounded shadow",children:Array.isArray(o)&&o.length>0&&o.map((s,t)=>{var d;return e.jsx("li",{className:"border-b py-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{children:["📅"," ",s.given_at||"بانتظار الموافقة"]}),e.jsxs("div",{children:["💵 ",s.amount," ج.م"]}),e.jsxs("div",{children:["💸 ",s.method," "]}),e.jsxs("div",{children:["📝 ",s.note]}),e.jsxs("div",{children:["📝 ",((d=s.project)==null?void 0:d.name)||"اخرى"]})]}),e.jsx("div",{children:e.jsx(k,{id:s.id,routeName:"admin.advance.delete"})})]})},t)})})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold mb-2 mt-3",children:"المصروفات"}),e.jsx("ul",{className:"bg-white p-4 rounded shadow",children:U.map((s,t)=>e.jsx("li",{className:"border-b py-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{children:["📅 ",s.spent_at]}),e.jsxs("div",{children:["💸 ",s.amount," ج"]}),e.jsxs("div",{children:["📝 ",s.description]})]}),e.jsx("div",{children:e.jsx(k,{id:s.id,routeName:""})})]})},t))})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold mb-2 mt-3",children:"الاستقطاعات"}),e.jsx("ul",{className:"bg-white p-4 rounded shadow",children:W.map((s,t)=>e.jsx("li",{className:"border-b py-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{children:["📅 ",s.deducted_at]}),e.jsxs("div",{children:["💸 ",s.amount," ج"]}),e.jsxs("div",{children:["📝 ",s.note]}),e.jsxs("div",{children:["📝 ",s.type==="basic"?"استقطاع":s.type==="deduction"?"جزاء":""]})]}),e.jsx("div",{children:e.jsx(k,{id:s.id,routeName:"admin.deduction.delete"})})]})},t))})]})]}),e.jsxs("div",{className:"mt-10 md:grid grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-white p-4 rounded shadow",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"إضافة عهدة جديدة"}),e.jsxs("form",{onSubmit:s=>{s.preventDefault(),console.log("postadvance"),K(route("admin.advance.store"),{preserveScroll:!0,onSuccess:()=>T()})},children:[e.jsx("input",{required:!0,type:"number",onWheel:s=>s.target.blur(),placeholder:"المبلغ",value:p.amount,onChange:s=>j("amount",s.target.value),className:"w-full border p-2 mb-2"}),v.amount&&e.jsx("div",{className:"text-red-600",children:v.amount}),e.jsx("input",{required:!0,type:"text",placeholder:"الغرض من العهدة",value:p.note,onChange:s=>j("note",s.target.value),className:"w-full border p-2 mb-2"}),v.note&&e.jsx("div",{className:"text-red-600",children:v.note}),e.jsxs("select",{required:!0,value:p.project_id,onChange:s=>j("project_id",s.target.value),className:"w-full border p-2 mb-2",children:[e.jsx("option",{value:"",children:"للمشروع"}),a.active_projects.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id)),e.jsx("option",{value:"null",children:"اخرى"})]}),e.jsxs("select",{required:!0,className:"w-full p-2 border rounded mb-4",value:p.method,onChange:s=>j("method",s.target.value),children:[e.jsx("option",{value:"",children:"-- اختر طريقة --"}),e.jsx("option",{value:"cash",children:"كاش"}),e.jsx("option",{value:"wallet",children:"محفظة"}),e.jsx("option",{value:"insta",children:"انستا باي"}),e.jsx("option",{value:"bank",children:"تحويل بنكي"})]}),e.jsx("button",{type:"submit",disabled:Q,className:"bg-blue-500 text-white px-4 py-2 rounded",children:"حفظ العهدة"})]})]}),e.jsxs("div",{className:"bg-white p-4 rounded shadow",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"إضافة مصروف"}),e.jsxs("form",{onSubmit:s=>{s.preventDefault(),X(route("employee.expense.store"),{preserveScroll:!0,onSuccess:()=>Z()})},children:[e.jsx("input",{type:"number",onWheel:s=>s.target.blur(),placeholder:"المبلغ",value:M.amount,onChange:s=>P("amount",s.target.value),className:"w-full border p-2 mb-2"}),b.note&&e.jsx("div",{className:"text-red-600",children:b.note}),e.jsx("input",{type:"text",placeholder:"الوصف",value:M.description,onChange:s=>P("description",s.target.value),className:"w-full border p-2 mb-2"}),b.description&&e.jsx("div",{className:"text-red-600",children:b.description}),e.jsx("button",{type:"submit",disabled:Y,className:"bg-green-500 text-white px-4 py-2 rounded",children:"حفظ المصروف"})]})]}),e.jsxs("div",{className:"bg-white p-4 rounded shadow",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"إضافة استقطاعات"}),e.jsxs("form",{onSubmit:s=>{s.preventDefault(),$(route("admin.deduction.store"),{preserveScroll:!0,onSuccess:()=>se()})},children:[e.jsx("input",{type:"number",onWheel:s=>s.target.blur(),placeholder:"المبلغ",value:i.amount,onChange:s=>g("amount",s.target.value),className:"w-full border p-2 mb-2"}),l.amount&&e.jsx("div",{className:"text-red-600",children:l.amount}),e.jsxs("select",{className:"w-full border p-2 mb-2",value:i.type,onChange:s=>g("type",s.target.value),required:!0,children:[e.jsx("option",{value:"",children:"نوع الاستقطاع"}),e.jsx("option",{value:"basic",children:"اساسى"}),e.jsx("option",{value:"deduction",children:"جزاء"})]}),l.type&&e.jsx("div",{className:"text-red-600",children:l.type}),i.type==="deduction"&&e.jsx("input",{type:"date",name:"deducted_at",id:"deducted_at",className:"w-full border mb-2",value:i.deducted_at,onChange:s=>g("deducted_at",s.target.value),required:!0}),e.jsx("input",{type:"text",placeholder:"الوصف",value:i.note,onChange:s=>g("note",s.target.value),className:"w-full border p-2 mb-2"}),l.note&&e.jsx("div",{className:"text-red-600",children:l.note}),e.jsx("button",{type:"submit",disabled:ee,className:"bg-green-500 text-white px-4 py-2 rounded",children:"حفظ الاستقطاع"})]})]})]})]})]}),e.jsx("hr",{}),e.jsxs("h1",{className:"text-2xl font-bold text-gray-800 p-6 ",children:["السلف",e.jsx("button",{onClick:()=>c("loans"),children:e.jsxs("p",{className:"border p-1 border-black text-sm",children:["  ",n==="loans"?"اخفاء":"عرض"]})})]}),n==="loans"&&e.jsx(ie,{totalExpense:y,loans:a.loans,role:E}),e.jsx("hr",{}),e.jsxs("h1",{className:"text-2xl font-bold text-gray-800 p-6 ",children:["الاجازات",e.jsx("button",{onClick:()=>c("leaves"),children:e.jsxs("p",{className:"border p-1 border-black text-sm",children:["  ",n==="leaves"?"اخفاء":"عرض"]})})]}),n==="leaves"&&e.jsx(ce,{leaves:a.leaves,role:E})]}),B&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg w-full max-w-md",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"اختر طريقة تسليم العهدة"}),e.jsxs("select",{className:"w-full p-2 border rounded mb-4",value:A,onChange:s=>D(s.target.value),children:[e.jsx("option",{value:"",children:"-- اختر طريقة --"}),e.jsx("option",{value:"cash",children:"كاش"}),e.jsx("option",{value:"wallet",children:"محفظة"}),e.jsx("option",{value:"insta",children:"انستا باي"}),e.jsx("option",{value:"bank",children:"تحويل بنكي"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>h(!1),className:"bg-gray-200 px-4 py-2 rounded",children:"إلغاء"}),e.jsx("button",{onClick:V,disabled:!A,className:"bg-green-500 text-white px-4 py-2 rounded",children:"تأكيد الموافقة"})]})]})})]})}export{_e as default};
