import{a as V,r as L,u as X,j as e,H as Y}from"./app-C5LVs5cr.js";import{I as r}from"./InputLabel-COYVf9zD.js";import{T as o}from"./TextInput-CpNDknLr.js";import{P as Z}from"./PrimaryButton-BE0UzTJf.js";import{I as u}from"./InputError-Db4cZEQt.js";import $ from"./TaskList-Bq565wsM.js";import{A as R}from"./AuthenticatedLayout-C7k-IFEz.js";import"./ApplicationLogo-4m0GVCqH.js";import"./ResponsiveNavLink-Dv9n9iiq.js";import"./transition-CGP49PDO.js";function ce({users:p,project:m,userIds:j}){const b=V().props.auth.user,x=(b==null?void 0:b.rolesnames)??[],[_,P]=L.useState(m.tasks.map(s=>{var a;return{id:s.id,title:s.title||"",task_number:s.task_number||"",description:s.description||"",start_date:s.start_date||"",end_date:s.end_date||"",quantity:s.quantity||"",unit:s.unit||"",tp:s.tp||"",up:s.unit_price||"",remaining:s.remaining??"",users:((a=s.users)==null?void 0:a.map(n=>n.id))??[]}})),{data:l,setData:i,post:U,processing:W,errors:c}=X({name:(m==null?void 0:m.name)||"",description:(m==null?void 0:m.description)||"",start_date:(m==null?void 0:m.start_date)||"",end_date:(m==null?void 0:m.end_date)||"",advance_payment:(m==null?void 0:m.advance_payment)||0,customer_name:(m==null?void 0:m.customer_name)||"",customer_email:(m==null?void 0:m.customer_email)||"",project_code:(m==null?void 0:m.project_code)||"",user_ids:j||[],tasks:_||[],tasksnew:[],projectId:m.id,send_email:!1}),H=s=>{s.preventDefault();const n=Object.values(_).map(d=>({...d,users:[...l.user_ids]}));P(n),i({...l,tasks:n})},N=new Date().toISOString().split("T")[0];L.useEffect(()=>{l.start_date||(i("start_date",N),i("end_date",N))},[]);const O=s=>{s.preventDefault(),U(route("admin.projects.update"))},z=Array.isArray(l==null?void 0:l.tasks)?l.tasks.map(s=>({...s,users:Array.isArray(s.users)?s.users.map(a=>typeof a=="object"?a.id:a):[]})):[],B=()=>{i("tasksnew",[...l.tasksnew,{title:"",description:"",start_date:"",users:[...j],end_date:"",quantity:"",unit:"",up:"",tp:""}])},G=(s,a,n)=>{const d=[...l.tasks];d[s][a]=n,i("tasks",d)},J=(s,a)=>{const n=Number(a),d=[...l.tasks],h=d[s].users||[];h.includes(n)?d[s].users=h.filter(g=>g!==n):d[s].users=[...h,n],i("tasks",d)},K=(s,a)=>{const n=Number(a),d=[...l.tasksnew],h=d[s].users||[];h.includes(n)?d[s].users=h.filter(g=>g!==n):d[s].users=[...h,n],i("tasksnew",d)},v=(s,a,n)=>{const d=[...l.tasksnew];d[s][a]=n,i("tasksnew",d)},M=s=>{const a=Number(s);let n=[...l.user_ids];n.includes(a)?n=n.filter(d=>d!==a):n.push(a),i("user_ids",n)},Q=(s,a)=>{s.preventDefault(),i(n=>{const d=n.tasksnew.filter((h,g)=>g!==a);return{...n,tasksnew:d}})};return e.jsxs(R,{children:[e.jsx(Y,{title:"ØªØ¹Ø¯ÙŠÙ„ Ù…Ø´Ø±ÙˆØ¹ "}),e.jsxs("div",{className:"mx-auto px-6 py-8 bg-white rounded shadow",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800 mb-6 text-center",children:"ØªØ¹Ø¯ÙŠÙ„ Ù…Ø´Ø±ÙˆØ¹ "}),e.jsxs("form",{onSubmit:O,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"name",value:"Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"}),e.jsx(o,{id:"name",type:"text",value:l.name,className:"mt-1 block w-full",onChange:s=>i("name",s.target.value),required:!0}),e.jsx(u,{message:c.name,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"customer_name",value:"Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„"}),e.jsx(o,{id:"name",type:"text",value:l.customer_name,className:"mt-1 block w-full",onChange:s=>i("customer_name",s.target.value)}),e.jsx(u,{message:c.customer_name,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"customer_email",value:"Ø§ÙŠÙ…ÙŠÙ„ Ø§Ù„Ø¹Ù…ÙŠÙ„"}),e.jsx(o,{id:"name",type:"text",value:l.customer_email,className:"mt-1 block w-full",onChange:s=>i("customer_email",s.target.value)}),e.jsx(u,{message:c.customer_email,className:"mt-2"})]}),e.jsxs("div",{className:"border p-2",children:[e.jsx(r,{htmlFor:"send_email",value:" Ø§Ø±Ø³Ø§Ù„ Ø§Ø´Ø¹Ø§Ø±"}),e.jsx(o,{id:"name",type:"checkbox",value:l.send_email,className:"mt-1 block",onChange:s=>i("send_email",s.target.value)}),e.jsx(u,{message:c.send_email,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"project_code",value:"ÙƒÙˆØ¯ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ "}),e.jsx(o,{id:"name",type:"text",value:l.project_code,className:"mt-1 block w-full",onChange:s=>i("project_code",s.target.value)}),e.jsx(u,{message:c.project_code,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"description",value:"ÙˆØµÙ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"}),e.jsx(o,{id:"description",type:"text",value:l.description,className:"mt-1 block w-full",onChange:s=>i("description",s.target.value)}),e.jsx(u,{message:c.description,className:"mt-2"})]}),["admin","acc"].some(s=>x==null?void 0:x.includes(s))&&e.jsxs("div",{children:[e.jsx(r,{htmlFor:"advance_payment",value:"Ø¯ÙØ¹Ù‡ Ù…Ù‚Ø¯Ù…Ù‡ "}),e.jsx(o,{id:"advance_payment",type:"number",value:l.advance_payment,className:"mt-1 block w-full",onWheel:s=>s.target.blur(),onChange:s=>i("advance_payment",s.target.value)}),e.jsx(u,{message:c.advance_payment,className:"mt-2"})]}),!x.includes("tech")&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"start_date",value:"ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©"}),e.jsx(o,{id:"start_date",type:"date",value:l.start_date,className:"mt-1 block w-full",onChange:s=>i("start_date",s.target.value)}),e.jsx(u,{message:c.start_date,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"end_date",value:"ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ù‡Ø§ÙŠØ©"}),e.jsx(o,{id:"end_date",type:"date",value:l.end_date,className:"mt-1 block w-full",onChange:s=>i("end_date",s.target.value)}),e.jsx(u,{message:c.end_date,className:"mt-2"})]})]}),e.jsxs("div",{className:"border p-2",children:[e.jsxs(r,{className:"mb-2",htmlFor:"user_ids",children:[e.jsx("p",{className:"inline",children:"ÙØ±ÙŠÙ‚ Ø§Ù„Ø¹Ù…Ù„"}),e.jsx("button",{className:"inline mr-2 text-blue-500 text-sm underline",onClick:s=>H(s),children:"ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù„Ù‰ ÙƒÙ„ Ø§Ù„Ù…Ù‡Ø§Ù…"})]}),p==null?void 0:p.map(s=>{var a;return e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",value:s.id,checked:(a=l.user_ids)==null?void 0:a.includes(Number(s.id)),onChange:()=>M(s.id),className:"mr-2 ml-1"}),s.name]},s.id)}),e.jsx(u,{message:c.user_ids,className:"mt-2"})]})]}),e.jsxs("div",{className:"p-4 mb-4 bg-gray-50 rounded border space-y-3 ",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2 position-sticky top-0 sticky p-3 bg-white",children:[e.jsx(r,{value:"Ø¨Ù†ÙˆØ¯ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"}),e.jsx("button",{type:"button",onClick:B,className:"text-sm text-blue-600 hover:underline",children:"+ Ø¥Ø¶Ø§ÙØ© Ø¨Ù†Ø¯"})]}),e.jsx($,{tasks:z,setData:i,errors:c,handleTaskChange:G,handleCheckboxChange:J,users:p,userIds:l.user_ids,userRoles:x}),l.tasksnew.map((s,a)=>{var n,d,h,g,y,f,k,w,C,T,F,q,A,E,I,S;return e.jsxs("div",{className:"p-4 mb-4 bg-gray-50 rounded border space-y-3 grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx(r,{className:"mt-3",value:"Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ø¯"}),e.jsx(o,{type:"text",value:s.title,onChange:t=>v(a,"title",t.target.value),className:"mt-1 block w-full",required:!0}),e.jsx(u,{message:(d=(n=c.tasks)==null?void 0:n[a])==null?void 0:d.title,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(r,{value:"ÙˆØµÙ Ø§Ù„Ø¨Ù†Ø¯"}),e.jsx(o,{type:"text",value:s.description,onChange:t=>v(a,"description",t.target.value),className:"mt-1 block w-full"}),e.jsx(u,{message:(g=(h=c.tasks)==null?void 0:h[a])==null?void 0:g.description,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(r,{value:"Ø§Ù„ÙƒÙ…ÙŠØ© "}),e.jsx(o,{type:"number",value:s.quantity,onWheel:t=>t.target.blur(),onChange:t=>v(a,"quantity",t.target.value),className:"mt-1 block w-full",required:!0}),e.jsx(u,{message:(f=(y=c.tasks)==null?void 0:y[a])==null?void 0:f.quantity,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(r,{value:" .Ø§Ù„ÙˆØ­Ø¯Ø©"}),e.jsxs("select",{required:!0,value:s.unit,onChange:t=>v(a,"unit",t.target.value),className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",disabled:!0,children:"choose Unit"}),e.jsx("option",{value:"meter",children:"meter"}),e.jsx("option",{value:"number",children:"number"}),e.jsx("option",{value:"ls",children:"LS"}),e.jsx("option",{value:"collaborative",children:"ØªØ¹Ø§ÙˆÙ†Ù‰"})]}),e.jsx(u,{message:(w=(k=c.tasks)==null?void 0:k[a])==null?void 0:w.unit,className:"mt-1"})]}),["admin","acc"].some(t=>x==null?void 0:x.includes(t))&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(r,{value:"Ø³Ø¹Ø± Ø§Ù„ÙˆØ­Ø¯Ø© "}),e.jsx(o,{type:"number",value:s.up,step:"0.01",onWheel:t=>t.target.blur(),onChange:t=>v(a,"up",t.target.value),className:"mt-1 block w-full"}),e.jsx(u,{message:(T=(C=c.tasks)==null?void 0:C[a])==null?void 0:T.up,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(r,{value:"Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø§Ø¬Ù…Ø§Ù„Ù‰ "}),e.jsx(o,{type:"number",value:s.up*s.quantity,onWheel:t=>t.target.blur(),onChange:t=>v(a,"tp",t.target.value),className:"mt-1 block w-full"}),e.jsx(u,{message:(q=(F=c.tasks)==null?void 0:F[a])==null?void 0:q.tp,className:"mt-1"})]})]}),["admin","proj"].some(t=>x==null?void 0:x.includes(t))&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(r,{value:"ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©"}),e.jsx(o,{type:"date",value:s.start_date,min:l.start_date,max:l.end_date,onChange:t=>v(a,"start_date",t.target.value),className:"mt-1 block w-full"}),e.jsx(u,{message:(E=(A=c.tasks)==null?void 0:A[a])==null?void 0:E.start_date,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(r,{value:"ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ù‡Ø§ÙŠØ©"}),e.jsx(o,{type:"date",value:s.end_date,min:l.start_date,max:l.end_date,onChange:t=>v(a,"end_date",t.target.value),className:"mt-1 block w-full"}),e.jsx(u,{message:(S=(I=c.tasks)==null?void 0:I[a])==null?void 0:S.end_date,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(r,{value:" Ø§Ø³Ù†Ø§Ø¯ Ø§Ù„Ù…Ù‡Ø§Ù…"}),e.jsx("div",{className:"bg-white border gap-2 grid grid-cols-2 mt-1 p-1.5",children:p==null?void 0:p.map(t=>{var D;return e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",value:t.id,checked:(D=s.users)==null?void 0:D.includes(t.id),onChange:()=>K(a,t.id),className:"mr-2 ml-1"}),t.name]},t.id)})})]})]}),e.jsx("button",{onClick:t=>Q(t,a),className:"text-red-500 hover:underline text-sm",children:"ğŸ—‘ Ø­Ø°Ù"})]},a)})]}),e.jsx("div",{children:e.jsx(Z,{className:"btn btn-green btn-fixed-bottom",disabled:W,children:"ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"})})]})]})]})}export{ce as default};
