import{r as p,j as e,u as N,a as R,b}from"./app-DM1yzmg1.js";import O from"./ProjectProgress-Dse3SwcF.js";import{U as $}from"./UserLayout-BmLAkYrA.js";import{d as E,u as L,e as Q,g as _,r as U,t as H,M as z,a as A,b as G,c as J,B as S}from"./ModalHeader-B1iXF9t4.js";import"./DeleteButton-BFvJn_PV.js";import"./HandelDelete-CZrOR3lX.js";import"./ApplicationLogo-ZbhgfKwJ.js";import"./ResponsiveNavLink-1h3eJXjO.js";import"./transition-DDZyfpeE.js";import"./index-CwvkirtL.js";const K=E({base:"block w-full rounded-lg border p-2.5 text-sm focus:outline-none focus:ring-1 disabled:cursor-not-allowed disabled:opacity-50",colors:{gray:"border-gray-300 bg-gray-50 text-gray-900 focus:border-primary-500 focus:ring-primary-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white dark:placeholder-gray-400 dark:focus:border-primary-500 dark:focus:ring-primary-500",info:"border-cyan-500 bg-cyan-50 text-cyan-900 placeholder-cyan-700 focus:border-cyan-500 focus:ring-cyan-500 dark:border-cyan-400 dark:bg-cyan-100 dark:focus:border-cyan-500 dark:focus:ring-cyan-500",failure:"border-red-500 bg-red-50 text-red-900 placeholder-red-700 focus:border-red-500 focus:ring-red-500 dark:border-red-400 dark:bg-red-100 dark:focus:border-red-500 dark:focus:ring-red-500",warning:"border-yellow-500 bg-yellow-50 text-yellow-900 placeholder-yellow-700 focus:border-yellow-500 focus:ring-yellow-500 dark:border-yellow-400 dark:bg-yellow-100 dark:focus:border-yellow-500 dark:focus:ring-yellow-500",success:"border-green-500 bg-green-50 text-green-900 placeholder-green-700 focus:border-green-500 focus:ring-green-500 dark:border-green-400 dark:bg-green-100 dark:focus:border-green-500 dark:focus:ring-green-500"},withShadow:{on:"shadow-sm dark:shadow-sm-light",off:""}}),P=p.forwardRef((a,u)=>{var o,h;const i=L(),t=Q([K,(o=i.theme)==null?void 0:o.textarea,a.theme],[_(i.clearTheme,"textarea"),a.clearTheme],[_(i.applyTheme,"textarea"),a.applyTheme]),{className:c,color:x="gray",shadow:j,...m}=U(a,(h=i.props)==null?void 0:h.textarea);return e.jsx("textarea",{ref:u,className:H(t.base,t.colors[x],t.withShadow[j?"on":"off"],c),...m})});P.displayName="Textarea";function ce({project:a,tasks:u,attendances:i}){var v;console.log(u,"tasks");const t=i[a.id],c=t&&t.check_in_time,x=t&&t.check_out_time,[j,m]=p.useState(!1),[o,h]=p.useState({}),{post:V,processing:y}=N(),[W,l]=p.useState(!1),{props:q}=R(),k=q.flash.message,{post:X,processing:Y,errors:n}=N(),w=(s,r)=>{s.preventDefault();const d=o[r];if(!d||d<=0){alert("من فضلك أدخل كمية صحيحة");return}b.post(route("employee.task.progress.store"),{task_id:r,quantity_done:d},{preserveScroll:!0})},C=s=>{f("task_id",s),f("project_id",a.id),m(!0)},{data:M,setData:f,post:T,processing:Z,errors:g}=N({task_id:"",description:"",project_id:""}),F=()=>{T(route("issues.store"),{onSuccess:s=>{m(!1)}})},D=s=>{l(!0);const r=s?"attendance.checkin":"attendance.checkout";navigator.geolocation||(alert("المتصفح لا يدعم تحديد الموقع"),l(!1),b.post(route(r,a.id),{onFinish:()=>l(!1)})),navigator.geolocation&&navigator.geolocation.getCurrentPosition(d=>{const{latitude:I,longitude:B}=d.coords;console.log(d.coords),b.post(route(r,a.id),{location:`${I},${B}`},{onFinish:()=>l(!1)})},d=>{alert("حدث خطأ أثناء تحديد الموقع"),b.post(route(r,a.id),{onFinish:()=>l(!1)}),console.error(d),l(!1)}),l(!1)};return e.jsx($,{children:e.jsxs("div",{className:"p-6",children:[k&&e.jsx("div",{className:"bg-green-100 text-green-800 border border-green-300 p-2 rounded mt-4",children:k}),e.jsx("h1",{className:"text-2xl font-bold",children:a.name}),e.jsx("p",{className:"mb-4",children:a.description}),!x&&e.jsx("button",{onClick:()=>D(!c),disabled:y,className:`mt-2 px-4 py-2 rounded text-white ${c?"bg-red-600":"bg-green-600"}`,children:c?"تسجيل الانصراف":"تسجيل الحضور"}),e.jsx("hr",{className:"m-3"}),c&&e.jsxs("p",{children:[e.jsx("b",{className:"bg-[#dede] ml-2",children:"تم الحضور :"}),t.check_in_time,e.jsx("a",{href:"https://www.google.com/maps?q="+t.in_location,target:"_blank",class:"text-blue-600 underline",children:"عرض الموقع"})]}),x&&e.jsxs("p",{children:[e.jsx("b",{className:"bg-[#FF2D20]/10 ml-2",children:"تم الانصراف :"}),t.check_out_time,e.jsx("a",{href:"https://www.google.com/maps?q="+t.out_location,target:"_blank",class:"text-blue-600 underline",children:"عرض الموقع"})]}),e.jsx("hr",{className:"my-4"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold mb-3",children:" فريق العمل"}),e.jsx("ul",{className:"bg-white rounded shadow divide-y",children:(v=a.users)==null?void 0:v.map(s=>e.jsx("li",{className:"p-3",children:s.name},s.id))})]}),e.jsx("hr",{className:"my-4"}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"مهامي"}),e.jsx("ul",{className:"space-y-4",children:u.map(s=>e.jsxs("li",{className:"border p-4 rounded shadow",children:[e.jsxs("p",{className:"font-bold",children:["بند رقم ",s.task.task_number]}),e.jsx("h3",{className:"font-semibold",children:s.task.title}),e.jsx("p",{className:"mb-2",children:s.task.description}),e.jsxs("h4",{className:"mb-2",children:[e.jsxs("b",{children:["  ",s.task.quantity," -"," "]}),s.task.unit==="number"&&"عدد",s.task.unit==="meter"&&"متر",s.task.unit==="collaborative"&&"تعاونى",s.task.users.map(r=>e.jsxs("span",{className:"border m-2",children:[r.name," "]},r.id))]}),e.jsxs("p",{children:["الكمية اليومية المطلوبة:"," ",e.jsxs("strong",{children:[s.task.DailyQuantity," ",s.unit]})]}),e.jsxs("p",{children:["تاريخ البدء :",e.jsx("strong",{className:"mr-2",children:s.task.start_date})]}),e.jsxs("p",{children:["تاريخ الانتهاء :",e.jsx("strong",{className:"mr-2",children:s.task.end_date})]}),e.jsxs("p",{children:["مدة البند:",e.jsxs("strong",{className:"mr-2",children:[s.task.duration_days," -"," "]}),e.jsx("strong",{children:"يوم"})]}),s.task.isBehindSchedule&&e.jsx("div",{className:"my-4 bg-red-100 text-red-800 px-4 py-2 rounded",children:"⚠️ أنت متأخر عن الخطة اليومية! حاول إنجاز المزيد."}),e.jsxs("p",{children:["اجمالى ما تم :",e.jsxs("strong",{className:"mr-2",children:[s.task.unit==="collaborative"?s.task.total_done/s.task.users_count:s.task.total_done,"-"]}),e.jsxs("strong",{children:[s.task.unit==="number"&&"عدد",s.task.unit==="meter"&&"متر",s.task.unit==="collaborative"&&"تعاونى"]})]}),e.jsxs("p",{children:["المتبقى:",e.jsxs("strong",{className:"mr-2",children:[s.task.remaining,"-"]}),e.jsxs("strong",{children:[s.task.unit==="number"&&"عدد",s.task.unit==="meter"&&"متر",s.task.unit==="collaborative"&&"تعاونى"]})]}),e.jsxs("div",{className:"mt-2 space-x-2",children:[s.task.remaining<1?e.jsx("button",{disabled:!0,className:" bg-green-500  px-3 py-1 rounded text-white",children:"مكتمله"}):e.jsxs(e.Fragment,{children:[e.jsx("hr",{className:"my-3"}),e.jsxs("h2",{className:"text-lg font-bold mb-4",children:["تسجيل تقدم في المهمة: ",s.task.title]}),e.jsxs("form",{onSubmit:r=>w(r,s.task.id),className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("input",{type:"hidden",name:"task_id",value:s.task.id}),e.jsx("label",{className:"block mb-1",children:"الكمية المنجزة اليوم"}),e.jsx("input",{type:"number",className:"w-full border rounded px-3 py-2",value:o[s.task.id]||"",onChange:r=>h({...o,[s.task.id]:r.target.value}),min:1,required:!0}),n.quantity_done&&e.jsx("div",{className:"text-red-600",children:n.quantity_done}),n.task_id&&e.jsx("div",{className:"text-red-600",children:n.task_id})]}),e.jsx("button",{type:"submit",className:" bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded disabled:opacity-50",disabled:y,children:"حفظ"})]})]}),a.id===42&&s.task.remaining<1&&e.jsxs(e.Fragment,{children:[e.jsx("hr",{className:"my-3"}),e.jsxs("h2",{className:"text-lg font-bold mb-4",children:["تسجيل تقدم في المهمة: ",s.task.title]}),e.jsxs("form",{onSubmit:r=>w(r,s.task.id),className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("input",{type:"hidden",name:"task_id",value:s.task.id}),e.jsx("label",{className:"block mb-1",children:"الكمية المنجزة اليوم"}),e.jsx("input",{type:"number",className:"w-full border rounded px-3 py-2",value:o[s.task.id]||"",onChange:r=>h({...o,[s.task.id]:r.target.value}),min:1,required:!0}),n.quantity_done&&e.jsx("div",{className:"text-red-600",children:n.quantity_done}),n.task_id&&e.jsx("div",{className:"text-red-600",children:n.task_id})]}),e.jsx("button",{type:"submit",className:" bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded disabled:opacity-50",disabled:y,children:"حفظ"})]})]}),!s.task.remaining<1&&e.jsx("button",{onClick:()=>C(s.task.id),className:"mt-1 bg-red-500 text-white px-3 py-1 rounded",children:"الإبلاغ عن مشكلة"}),e.jsx("hr",{className:"my-3"}),e.jsxs(z,{show:j,onClose:()=>m(!1),children:[e.jsx(A,{children:" الإبلاغ عن مشكلة "}),e.jsx(G,{children:e.jsx("div",{className:"space-y-6",children:e.jsxs("form",{method:"POST",children:[e.jsx(P,{name:"description",className:"w-full border p-2",placeholder:"اشرح المشكلة هنا...",value:M.description,onChange:r=>f("description",r.target.value)}),g.task_id&&e.jsx("div",{className:"text-red-500 text-sm mt-1",children:g.task_id}),g.description&&e.jsx("div",{className:"text-red-500 text-sm mt-1",children:g.description})]})})}),e.jsxs(J,{children:[e.jsx(S,{onClick:F,children:"الإبلاغ"}),e.jsx(S,{color:"gray",onClick:()=>m(!1),children:"إغلق"})]})]}),e.jsx(O,{task:s.task})]})]},s.id))})]})})}export{ce as default};
