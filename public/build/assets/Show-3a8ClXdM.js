import{a as $,r as n,j as e,L as z}from"./app-k5SopBD2.js";import{d as C}from"./dayjs.min-wkxdeqzy.js";import{u as T}from"./useGeolocation-BAAKlcRJ.js";import{U}from"./UserLayout-D9fQAYDD.js";import"./ApplicationLogo-DU4WzsOm.js";import"./ResponsiveNavLink-Da99mX_u.js";import"./transition-C9FumlRJ.js";function O(){var b,g,f,j,y,N,w,v,k,_,S;const{visit:t}=$().props,[D,c]=n.useState(!1),[d,E]=n.useState(""),[m,M]=n.useState(null),[x,Y]=n.useState(t.notes||""),[u,L]=n.useState(null),[o,i]=n.useState(!1),[H,h]=n.useState(!1),[V,p]=n.useState(!1),{getLocation:R}=T(),q=async s=>{s.preventDefault(),i(!0);const l=await R(),a=new FormData;a.append("notes",d),a.append("location",`${l.latitude},${l.longitude}`),m&&a.append("report",m);try{const r=await axios.post(route("visits.update",t.id),a,{headers:{"Content-Type":"multipart/form-data"}});console.log(r),r.data.success&&(p(!0),window.location.href=r.data.redirect)}catch(r){console.error(r)}},F=async s=>{s.preventDefault(),i(!0);const l=new FormData;l.append("notes",x),u&&l.append("report",u);try{const a=await axios.post(route("visits.edit",t.id),l,{headers:{"Content-Type":"multipart/form-data"}});console.log(a),a.data.status===200&&(p(!0),window.location.reload)}catch(a){alert(a.response.data.message),console.error(a),i(!1)}window.location.reload()};return e.jsx(U,{children:e.jsxs("div",{className:"max-w-3xl mx-auto bg-white rounded-lg shadow p-6 mt-8 space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800 border-b pb-2",children:"تفاصيل الزيارة"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-gray-600",children:"اسم العميل:"}),e.jsx("span",{className:"ml-2 text-gray-800",children:t.customer.name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-gray-600",children:"وقت الحضور:"}),e.jsx("span",{className:"ml-2 text-blue-600",children:(b=t.attendance)!=null&&b.check_in_time?C((g=t.attendance)==null?void 0:g.check_in_time).format("YYYY-MM-DD HH:mm"):"لم يتم بعد"}),e.jsx("span",{className:"font-semibold text-gray-600",children:"موقع الحضور:"}),e.jsx("span",{className:"ml-2 text-blue-600",children:e.jsx("a",{href:"https://www.google.com/maps?q="+((f=t.attendance)==null?void 0:f.in_location),target:"_blank",className:"text-blue-600 underline",children:"عرض"})})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-gray-600",children:"وقت الانصراف:"}),e.jsx("span",{className:"ml-2 text-green-600",children:(j=t.attendance)!=null&&j.check_out_time?C((y=t.attendance)==null?void 0:y.check_out_time).format("YYYY-MM-DD HH:mm"):"لم يتم بعد"}),((N=t.attendance)==null?void 0:N.check_out_time)&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"font-semibold text-gray-600",children:"موقع الانصراف:"}),e.jsx("span",{className:"ml-2 text-blue-600",children:e.jsx("a",{href:"https://www.google.com/maps?q="+((w=t.attendance)==null?void 0:w.out_location),target:"_blank",className:"text-blue-600 underline",children:"عرض"})})]})]}),t.notes&&e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-gray-600",children:"ملاحظات:"}),e.jsx("p",{className:"mt-1 text-gray-700",children:t.notes})]}),((v=t.attendance)==null?void 0:v.check_out_time)&&t.report_path&&e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-gray-600",children:"تقرير الزيارة:"}),e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:`/storage/${t.report_path}`,alt:"تقرير الزيارة",className:"max-w-xs border rounded shadow"})})]}),!((k=t.attendance)!=null&&k.check_out_time)&&e.jsx("div",{children:e.jsx("button",{onClick:()=>c(!0),className:"bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 transition",children:"إنهاء الزيارة"})}),((_=t.attendance)==null?void 0:_.check_out_time)&&e.jsx("div",{className:"bg-green-100 text-green-700 px-4 py-2 rounded",children:"تم إنهاء الزيارة بنجاح"})]}),e.jsxs("div",{className:"flex items-center justify-between mt-6",children:[e.jsx(z,{href:route("visits.index"),className:"text-sm text-blue-600 hover:underline",children:"← العودة إلى قائمة الزيارات"}),((S=t.attendance)==null?void 0:S.check_out_time)&&e.jsx("button",{onClick:()=>h(!0),className:"hover:bg-red-700 py-2 text-blue-800 transition",children:"تعديل الزيارة"})]}),D&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white w-full max-w-md rounded-lg p-6 relative",children:[e.jsx("h2",{className:"text-lg font-bold mb-4",children:"إنهاء الزيارة"}),e.jsxs("form",{onSubmit:q,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"ملاحظات"}),e.jsx("textarea",{value:d,onChange:s=>E(s.target.value),className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm",rows:3,placeholder:"أدخل أي ملاحظات عن الزيارة"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"تقرير الزيارة (صورة)"}),e.jsx("input",{type:"file",accept:"image/*",onChange:s=>M(s.target.files[0]),className:"mt-1 block w-full text-sm text-gray-600",required:!0})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{type:"button",onClick:()=>c(!1),className:"px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300",children:"إلغاء"}),e.jsx("button",{type:"submit",disabled:o,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:o?"جارٍ الإرسال...":"إنهاء الزيارة"})]})]})]})}),H&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white w-full max-w-md rounded-lg p-6 relative",children:[e.jsx("h2",{className:"text-lg font-bold mb-4",children:"تعديل الزيارة"}),e.jsxs("form",{onSubmit:F,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"ملاحظات"}),e.jsx("textarea",{value:x,onChange:s=>Y(s.target.value),className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm",rows:3,placeholder:"أدخل أي ملاحظات عن الزيارة"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"تقرير الزيارة (صورة)"}),e.jsx("input",{type:"file",accept:"image/*",onChange:s=>L(s.target.files[0]),className:"mt-1 block w-full text-sm text-gray-600"})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{type:"button",onClick:()=>h(!1),className:"px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300",children:"إلغاء"}),e.jsx("button",{type:"submit",disabled:o,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:o?"جارٍ الإرسال...":"تعديل الزيارة"})]})]})]})})]})})}export{O as default};
