import{a as M,r as b,u as V,j as e,b as Y}from"./app-BMMUUtt3.js";import{I as r}from"./InputLabel-DSJSc-3T.js";import{T as d}from"./TextInput-Rb1iCQqQ.js";import{I as c}from"./InputError-DtRXT7ea.js";const ie=({tasks:h,setData:y,errors:i,handleTaskChange:o,users:u,handleCheckboxChange:k,userRoles:n,userIds:Q})=>{const T=M().props.auth.user,[Z,$]=b.useState({task:"",qty:""}),[R,ee]=b.useState(""),[f,N]=b.useState(""),[x,w]=b.useState({}),{post:te,processing:K,errors:se}=V(),g=Array.isArray(h)?h:[h],X=async(s,a)=>{if(s.preventDefault(),!!confirm("Are you sure you want to delete this task?"))try{if((await(await fetch("/admin/task/delete/"+a,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}})).json()).success){const m=g.filter(j=>j.id!==a);y("tasks",m.length===1?m[0]:m)}else alert("Failed to delete task.")}catch(l){console.error("Error deleting task:",l),alert("Something went wrong.")}},z=(s,a)=>{s.preventDefault();const l=[...g];l[a].users=Q,y("tasks",l)},B=(s,a)=>{w(l=>({...l,[a]:{...l[a],qty:s}}))},G=(s,a)=>{w(l=>({...l,[a]:{...l[a],user_id:s}}))},H=(s,a)=>{s.preventDefault();const l=x[a];!a||!(l!=null&&l.user_id)||l!=null&&l.qty,Y.post(route("admin.task.progress.store"),{task_id:a,user_id:l.user_id,quantity_done:l.qty},{preserveScroll:!0})},J=s=>{N(f===s?"":s)};return e.jsx(e.Fragment,{children:g&&g.map((s,a)=>{var l,v,m,j,q,S,_,C,D,F,A,E,L,I,U,W,O,P;return e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"font-bold",children:["بند رقم ",s.task_number]}),e.jsxs("div",{className:"p-4 mb-4 bg-gray-50 rounded border space-y-3 grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx(r,{className:"mt-3",value:"اسم البند"}),e.jsx(d,{required:!0,type:"text",value:s==null?void 0:s.title,onChange:t=>o(a,"title",t.target.value),className:"mt-1 block w-full"}),e.jsx(c,{message:(v=(l=i.tasks)==null?void 0:l[a])==null?void 0:v.title,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(r,{value:"وصف البند"}),e.jsx(d,{type:"text",value:s.description,onChange:t=>o(a,"description",t.target.value),className:"mt-1 block w-full"}),e.jsx(c,{message:(j=(m=i.tasks)==null?void 0:m[a])==null?void 0:j.description,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(r,{value:"الكمية "}),e.jsx(d,{required:!0,type:"number",value:s.quantity,onWheel:t=>t.target.blur(),onChange:t=>o(a,"quantity",t.target.value),className:"mt-1 block w-full"}),e.jsx(c,{message:(S=(q=i.tasks)==null?void 0:q[a])==null?void 0:S.quantity,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(r,{value:" الوحدة"}),e.jsxs("select",{required:!0,value:s.unit,onChange:t=>o(a,"unit",t.target.value),className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",disabled:!0,children:"choose Unit"}),e.jsx("option",{value:"meter",children:"meter"}),e.jsx("option",{value:"number",children:"number"}),e.jsx("option",{value:"ls",children:"LS"}),e.jsx("option",{value:"collaborative",children:"تعاونى"})]}),e.jsx(c,{message:(C=(_=i.tasks)==null?void 0:_[a])==null?void 0:C.unit,className:"mt-1"})]}),["admin","acc"].some(t=>n==null?void 0:n.includes(t))&&T.email!=="sherok@trustits.net"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(r,{value:"سعر الوحدة "}),e.jsx(d,{type:"number",step:"0.01",value:s.up,onWheel:t=>t.target.blur(),onChange:t=>o(a,"up",t.target.value),className:"mt-1 block w-full"}),e.jsx(c,{message:(F=(D=i.tasks)==null?void 0:D[a])==null?void 0:F.up,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(r,{value:"السعر الاجمالى "}),e.jsx(d,{type:"number",value:s.up*s.quantity,onWheel:t=>t.target.blur(),onChange:t=>o(a,"tp",t.target.value),className:"mt-1 block w-full"}),e.jsx(c,{message:(E=(A=i.tasks)==null?void 0:A[a])==null?void 0:E.tp,className:"mt-1"})]})]}),["admin","proj"].some(t=>n==null?void 0:n.includes(t))&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(r,{value:"تاريخ البداية"}),e.jsx(d,{type:"date",value:s.start_date,onChange:t=>o(a,"start_date",t.target.value),className:"mt-1 block w-full"}),e.jsx(c,{message:(I=(L=i.tasks)==null?void 0:L[a])==null?void 0:I.start_date,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(r,{value:"تاريخ النهاية"}),e.jsx(d,{type:"date",value:s.end_date,onChange:t=>o(a,"end_date",t.target.value),className:"mt-1 block w-full"}),e.jsx(c,{message:(W=(U=i.tasks)==null?void 0:U[a])==null?void 0:W.end_date,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsxs(r,{className:"mb-2",children:[e.jsx("p",{className:"cursor-pointer inline underline",onClick:t=>J(s.id),children:"اسناد المهام"}),e.jsx("button",{className:"inline mr-2 text-blue-500 text-sm underline",onClick:t=>z(t,a),children:"نسخ فريق عمل المشروع"})]}),f===s.id&&e.jsx("div",{className:"bg-white border gap-2 grid grid-cols-2 mt-1 p-1.5",children:u==null?void 0:u.map(t=>{var p;return e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",value:t.id,checked:(p=s.users)==null?void 0:p.includes(t.id),onChange:()=>k(a,t.id),className:"mr-2 ml-1"}),t.name]},t.id)})})]})]}),e.jsx("div",{children:e.jsx("button",{onClick:t=>X(t,s.id),className:"active:bg-gray-900 bg-red-800 border border-transparent duration-150 ease-in-out focus:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 font-semibold hover:bg-gray-700 mt-7 py-2 rounded-md text-white text-xs tracking-widest transition w-full",children:"حذف"})}),["admin","proj"].some(t=>n==null?void 0:n.includes(t))&&s.remaining>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("label",{className:"block mb-1",children:"الكمية المنجزة"}),e.jsx("input",{type:"number",className:"w-full border rounded px-3 py-2",value:((O=x[s.id])==null?void 0:O.qty)||"",onChange:t=>B(t.target.value,s.id),min:1}),e.jsx("label",{className:"block mb-1 mt-2",children:"بواسطة"}),e.jsxs("select",{className:"w-full border rounded px-3 py-2",value:((P=x[s.id])==null?void 0:P.user_id)||"",onChange:t=>G(t.target.value,s.id),children:[e.jsx("option",{value:"",disabled:!0,children:"اختر الموظف"}),u==null?void 0:u.map(t=>{var p;return(p=s.users)!=null&&p.includes(t.id)?e.jsx("option",{value:t.id,children:t.name},t.id):null})]}),e.jsx("button",{onClick:t=>H(t,s.id),className:"mt-2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded disabled:opacity-50",disabled:K,children:"حفظ"})]})]},a)]})})})};export{ie as default};
