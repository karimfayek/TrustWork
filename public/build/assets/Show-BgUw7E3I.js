import{a as k,r as l,j as e,L as E}from"./app-D_jSzgv9.js";import{d as f}from"./dayjs.min-CfBljue0.js";import{A as S}from"./AuthenticatedLayout-DKT8FH73.js";import"./ApplicationLogo-DSf9Y3Wu.js";import"./ResponsiveNavLink-DMLI9H0y.js";import"./transition-CVEp-x0M.js";function q(){var m,x,h,p,u,b,g,j;const{visit:t}=k().props,[N,r]=l.useState(!1),[i,y]=l.useState(t.notes||""),[o,w]=l.useState(null),[d,c]=l.useState(!1),[Y,v]=l.useState(!1),_=async s=>{s.preventDefault(),c(!0);const n=new FormData;n.append("notes",i),o&&n.append("report",o);try{const a=await axios.post(route("visits.edit",t.id),n,{headers:{"Content-Type":"multipart/form-data"}});console.log(a),a.data.status===200&&(v(!0),window.location.reload)}catch(a){alert(a.response.data.message),console.error(a),c(!1)}window.location.reload()};return e.jsxs(S,{children:[e.jsxs("div",{className:"max-w-3xl mx-auto bg-white rounded-lg shadow p-6 mt-8 space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800 border-b pb-2",children:"تفاصيل الزيارة"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-gray-600",children:"اسم العميل:"}),e.jsx("span",{className:"ml-2 text-gray-800",children:t.customer.name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-gray-600",children:"وقت الحضور:"}),e.jsx("span",{className:"ml-2 text-blue-600",children:(m=t.attendance)!=null&&m.check_in_time?f((x=t.attendance)==null?void 0:x.check_in_time).format("YYYY-MM-DD HH:mm"):"لم يتم بعد"}),e.jsx("span",{className:"font-semibold text-gray-600",children:"موقع الحضور:"}),e.jsx("span",{className:"ml-2 text-blue-600",children:e.jsx("a",{href:"https://www.google.com/maps?q="+((h=t.attendance)==null?void 0:h.in_location),target:"_blank",className:"text-blue-600 underline",children:"عرض"})})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-gray-600",children:"وقت الانصراف:"}),e.jsx("span",{className:"ml-2 text-green-600",children:(p=t.attendance)!=null&&p.check_out_time?f((u=t.attendance)==null?void 0:u.check_out_time).format("YYYY-MM-DD HH:mm"):"لم يتم بعد"}),((b=t.attendance)==null?void 0:b.check_out_time)&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"font-semibold text-gray-600",children:"موقع الانصراف:"}),e.jsx("span",{className:"ml-2 text-blue-600",children:e.jsx("a",{href:"https://www.google.com/maps?q="+((g=t.attendance)==null?void 0:g.out_location),target:"_blank",className:"text-blue-600 underline",children:"عرض"})})]})]}),t.notes&&e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-gray-600",children:"ملاحظات:"}),e.jsx("p",{className:"mt-1 text-gray-700",children:t.notes})]}),((j=t.attendance)==null?void 0:j.check_out_time)&&t.report_path&&e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-gray-600",children:"تقرير الزيارة:"}),e.jsx("div",{className:"mt-2",children:e.jsx("a",{href:`/storage/${t.report_path}`,target:"_blank",children:e.jsx("img",{src:`/storage/${t.report_path}`,alt:"تقرير الزيارة",className:"max-w-xs border rounded shadow"})})})]})]}),e.jsxs("div",{className:"flex justify-between mt-6",children:[e.jsx(E,{href:route("admin.visits.index"),className:"text-sm text-blue-600 hover:underline",children:"← العودة إلى قائمة الزيارات"}),e.jsx("button",{onClick:()=>r(!0),className:"hover:bg-red-700 py-2 text-blue-800 transition",children:"تعديل الزيارة"})]})]}),N&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white w-full max-w-md rounded-lg p-6 relative",children:[e.jsx("h2",{className:"text-lg font-bold mb-4",children:"تعديل الزيارة"}),e.jsxs("form",{onSubmit:_,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"ملاحظات"}),e.jsx("textarea",{value:i,onChange:s=>y(s.target.value),className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm",rows:3,placeholder:"أدخل أي ملاحظات عن الزيارة"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"تقرير الزيارة (صورة)"}),e.jsx("input",{type:"file",accept:"image/*",onChange:s=>w(s.target.files[0]),className:"mt-1 block w-full text-sm text-gray-600"})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{type:"button",onClick:()=>r(!1),className:"px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300",children:"إلغاء"}),e.jsx("button",{type:"submit",disabled:d,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:d?"جارٍ الإرسال...":"تعديل الزيارة"})]})]})]})})]})}export{q as default};
