import{a as P,r as a,u as g,j as e,L as j}from"./app-CuU5X9XV.js";import{U as $}from"./UserLayout-GzsCu8zB.js";import z from"./AssignModal-ii2oYxna.js";import I from"./DetailsModal-BW3lPsMN.js";import"./ApplicationLogo-BZLer5By.js";import"./ResponsiveNavLink-Bst6hdvq.js";import"./transition-BOmXy35G.js";function Q({workOrders:p,employees:b}){const c=P().props.auth.user,[N,d]=a.useState(!1),[f,w]=a.useState(null),[y,x]=a.useState(!1),[v,_]=a.useState(null),[S,i]=a.useState(!1),{data:o,setData:h,post:D,processing:R}=g({employees:[]});function k(s){w(s),i(!0)}function M(s){_(s),x(!0)}function C(s){o.employees.includes(s)?h("employees",o.employees.filter(r=>r!==s)):h("employees",[...o.employees,s])}function L(){D(route("work-orders.assign",f.id),{onSuccess:()=>{i(!1),h("employees",[])}})}const{data:l,setData:n,post:O,processing:m,reset:A,errors:t}=g({client_name:"",client_phone:"",client_address:"",description:""});function E(s){s.preventDefault(),O(route("work-orders.store"),{onSuccess:()=>{A(),d(!1)}})}return e.jsxs($,{children:[e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h1",{className:"text-xl font-bold",children:"طلبات أوامر الشغل"}),e.jsx("button",{onClick:()=>d(!0),className:"bg-blue-600 text-white px-4 py-2 rounded",children:"➕ طلب جديد"})]}),e.jsx("div",{className:"bg-white rounded shadow overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 text-right",children:"العميل"}),e.jsx("th",{className:"p-2 text-right",children:"الهاتف"}),e.jsx("th",{className:"p-2 text-right",children:"العنوان"}),e.jsx("th",{className:"p-2 text-right",children:"التاريخ"}),e.jsx("th",{className:"p-2 text-right",children:"طلب"}),e.jsx("th",{className:"p-2 text-right",children:"الحالة"}),e.jsx("th",{className:"p-2 text-right",children:"الإجراءات"})]})}),e.jsxs("tbody",{children:[p.map(s=>{var r;return e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"p-2",children:s.client_name}),e.jsx("td",{className:"p-2",children:s.client_phone}),e.jsx("td",{className:"p-2",children:s.client_address}),e.jsx("td",{className:"p-2",children:new Date(s.created_at).toLocaleDateString()}),e.jsx("td",{className:"p-2",children:(r=s.creator)==null?void 0:r.name}),e.jsx("td",{className:"p-2",children:e.jsx("span",{className:`
    px-3 py-1 rounded text-white
    ${s.status==="pending"&&"bg-yellow-500"}
    ${s.status==="assigned"&&"bg-blue-500"}
    ${s.status==="completed"&&"bg-green-600"}
`,children:s.status})}),e.jsxs("td",{className:"p-2",children:[e.jsx(j,{href:route("work-orders.destroy",s.id),method:"delete",className:"bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700",children:"مسح"}),["operator","admin"].some(F=>{var u;return(u=c==null?void 0:c.rolesnames)==null?void 0:u.includes(F)})&&e.jsx(e.Fragment,{children:s.status!=="completed"&&e.jsxs(e.Fragment,{children:[e.jsx(j,{href:route("work-orders.complete",s.id),method:"post",className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700",children:"تم الانتهاء"}),e.jsx("button",{onClick:()=>k(s),className:"bg-blue-600 hover:bg-blue-700 mx-2 px-4 py-2 rounded text-white",children:"إسناد"})]})}),e.jsx("button",{onClick:()=>M(s),className:"bg-blue-600 hover:bg-blue-700 mx-2 px-4 py-2 rounded text-white",children:"تفاصيل"})]})]},s.id)}),!p.length&&e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"p-4 text-center text-gray-500",children:"لا توجد طلبات"})})]})]})}),N&&e.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white w-full max-w-lg rounded shadow p-6",children:[e.jsx("h2",{className:"text-lg font-bold mb-4",children:"طلب أمر شغل"}),e.jsxs("form",{onSubmit:E,className:"space-y-3",children:[e.jsx("input",{className:"w-full border rounded p-2",placeholder:"اسم العميل",value:l.client_name,onChange:s=>n("client_name",s.target.value)}),t.client_name&&e.jsx("p",{className:"text-red-500",children:t.client_name}),e.jsx("input",{className:"w-full border rounded p-2",placeholder:"رقم الهاتف",value:l.client_phone,onChange:s=>n("client_phone",s.target.value)}),t.client_phone&&e.jsx("p",{className:"text-red-500",children:t.client_phone}),e.jsx("input",{className:"w-full border rounded p-2",placeholder:"العنوان",value:l.client_address,onChange:s=>n("client_address",s.target.value)}),t.client_address&&e.jsx("p",{className:"text-red-500",children:t.client_address}),e.jsx("textarea",{className:"w-full border rounded p-2",rows:"3",placeholder:"زيارة / معاينة / تفاصيل",value:l.description,onChange:s=>n("description",s.target.value)}),t.description&&e.jsx("p",{className:"text-red-500",children:t.description}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{type:"button",onClick:()=>d(!1),className:"px-4 py-2 border rounded",children:"إلغاء"}),e.jsx("button",{disabled:m,className:"bg-green-600 text-white px-4 py-2 rounded",children:"✅ تأكيد"})]})]})]})})]}),e.jsx(z,{showModal:S,setShowModal:i,employees:b,toggleEmployee:C,submit:L,processing:m}),e.jsx(I,{showModal:y,setShowModal:x,order:v})]})}export{Q as default};
